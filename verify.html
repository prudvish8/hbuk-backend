<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>HBUK Verify</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script>window.API_BASE='https://hbuk-backend-hvow.onrender.com';</script>
  <style>
    body{font-family:system-ui, sans-serif;max-width:640px;margin:40px auto;padding:0 16px}
    label,input,button,textarea{font-size:16px}
    .row{margin:12px 0}
    .ok{color:green}.bad{color:#b00020}
  </style>
</head>
<body>
  <h1>Verify Entry</h1>
  <div class="row"><label>Entry ID</label><br/><input id="entryId" placeholder="64f..."/></div>
  <div class="row"><label>Digest</label><br/><input id="digest" placeholder="sha256 hex"/></div>
  <div class="row"><button id="btn">Verify</button></div>
  <pre id="out"></pre>

  <script type="module">
    import { apiRequest } from './api-utils.js';
    const id = document.getElementById('entryId');
    const digest = document.getElementById('digest');
    const out = document.getElementById('out');
    
    // Prefill fields from hash parameters
    function prefillFromHash() {
      const hash = location.hash.substring(1);
      const params = new URLSearchParams(hash);
      if (params.has('id')) id.value = params.get('id');
      if (params.has('digest')) digest.value = params.get('digest');
    }
    
    // Prefill on load
    prefillFromHash();
    
    document.getElementById('btn').onclick = async () => {
      out.textContent = 'Checking...';
      try{
        const res = await apiRequest(`/api/verify/${encodeURIComponent(id.value)}/${encodeURIComponent(digest.value)}`, { method: 'GET' });
        out.innerHTML = res.ok ? '<span class="ok">VALID ✅</span>' : '<span class="bad">TAMPERED ❌</span>';
      }catch(e){
        out.innerHTML = `<span class="bad">${e.message}</span>`;
      }
    };
  </script>
</body>
</html>
